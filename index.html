<!DOCTYPE html>
<html>

<head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
    <script src="moment.js"></script>
    <link href='http://fonts.googleapis.com/css?family=Poiret+One|Lobster|Open+Sans:300italic,300' rel='stylesheet' type='text/css'>
    <style>
    #logo {
        font: 4em 'Lobster', 'Poiret One', cursive, Arial, sans-serif;
        font-weight: bold;
        text-shadow: 2px 2px #d8d9da;
        color: #4d93f5;
        position: fixed;
        top: 50px;
        left: 150px;
    }
    
    #user-timeline {
        font: 1em 'Open Sans', sans-serif;
        font-weight: bold;
        color: #4d93f5;
        position: fixed;
        top: 50px;
        left: 420px;
        right: 420px;
        min-width: 400px;
        //background: linear-gradient(to bottom, #d1eaff , #fbfdfd);
        padding: 5px;
    }
    
    #container {
        overflow: hidden;
        position: fixed;
        right: 20px;
        left: 20px;
        top: 100px;
        bottom: 0;
    }
    
    .tweet {
        font: .9em 'Open Sans', Helvetica, Arial, sans-serif;
        border: 1px outset #dcdde0;
        border-radius: 8px;
        background-color: #ebf6ff;
        padding: 10px;
        margin: 15px;
    }
    
    .user {
        font-weight: bold;
    }
    
    .date {
        font-size: 0.5em;
        color: #606366;
    }
    
    #timeline {
        position: absolute;
        overflow-y: scroll;
        margin: 0 400px;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        height: 90%;
        border: 1px solid #e9eaec;
        border-radius: 10px;
        min-width: 400px;
    }
    
    #returnButton {
        box-shadow: inset 0px 1px 0px 0px #ffffff;
        background: linear-gradient(to bottom, #ffffff 5%, #f6f6f6 100%);
        background-color: #ffffff;
        border-radius: 6px;
        border: 1px solid #dcdcdc;
        cursor: pointer;
        color: #666666;
        font: 0.8em 'Open Sans', sans-serif;
        padding: 5px;
        text-shadow: 0px 1px 0px #ffffff;
        position: absolute;
        right: 0;
    }
    
    #returnButton:hover {
        background: linear-gradient(to bottom, #f6f6f6 5%, #ffffff 100%);
        background-color: #f6f6f6;
    }
    
    #returnButton:focus {
        outline: 0;
        box-shadow: none;
    }
    
    ::-webkit-scrollbar {
        width: 5px;
    }
    
    ::-webkit-scrollbar-thumb {
        border-radius: 20px;
        background: rgba(0, 0, 0, 0.1);
    }
    </style>
</head>

<body>
    <div id="logo">twittler</div>
    <div id="user-timeline"><span id="user">Guest's</span> Timeline</div>
    <div id="container">
        <div id="timeline"></div>
    </div>
    <script>
    $(document).ready(function() {

        //prompt for username to display on timeline 
        var user = prompt("Please enter your username", "Guest");
        if (user != null) {
            $("#user").text("@" + user + "'s");
        }

        //$("input").keyup(function() {
        //  var value = $(this).val();
        //  $("#user").text(value);
        //}).keyup();

        var timeline = $('#timeline');
        //$body.html('');

        displayTweets("main"); //display initial set of generated tweets
        var refresh = setInterval(function() {
            displayTweets("main");
        }, 5000); //display new tweets every 5 seconds

        hover(".user", "#4d93f5", "black");
        userClick();
        mainClick();

        function displayTweets(username) {
            var index, stream, userStream;

            if (username === "main") {
                index = streams.home.length - 1;
                stream = streams.home;
            } else {
                userStream = streams.users
                index = userStream[username].length - 1;
                stream = userStream[username];
            }

            $('.tweet').remove();
            while (index >= 0) {
                var tweet = stream[index];
                var $tweet = $('<div class="tweet"></div>');
                $tweet.html('<span class="user">@' + tweet.user + ':</span><br><br>' + tweet.message + '<br><br><span class="date">' + moment(tweet.created_at).fromNow() + '</span>');
                $tweet.appendTo(timeline);
                index -= 1;
            }
        }

        function hover(selection, color1, color2) {
            $(document).on({
                mouseenter: function() {
                    $(this).css("color", color1);
                    $(this).css("cursor", "pointer");
                },
                mouseleave: function() {
                    $(this).css("color", color2);
                    $(this).css('cursor', 'auto');
                }
            }, selection);
        }

        function userClick() {
            $(document).on("click", ".user", function() {
                var newUser = $(this).text();
                newUser = newUser.slice(1, -1);
                $("#user").text("@" + newUser + "'s")
                clearInterval(refresh);

                $("#returnButton").remove();
                $returnButton = $("<button typeof='button' id='returnButton'>&#8592 Return to " + user + "'s Timeline</button>");
                $returnButton.appendTo($("#user-timeline"));


                $("#timeline").scrollTop(0);
                displayTweets(newUser);
                refresh = setInterval(function() {
                    displayTweets(newUser);
                }, 5000);
            });
        }

        function mainClick() {
            $(document).on("click", "#returnButton", function() {
                $("#user").text("@" + user + "'s")
                $("#returnButton").remove();
                displayTweets("main");
                clearInterval(refresh);
                refresh = setInterval(function() {
                    displayTweets("main");
                }, 5000);
            });
        }
    });
    </script>
</body>

</html>